# AWS設定状況まとめ（ChatGPT相談用）

**プロジェクト**: hokka-beaver-quiz（中学校文化祭クイズラリー）  
**日時**: 2025-08-10 16:20 JST

## 1. 現在のAWSリソース状況

### EC2インスタンス
```yaml
インスタンス情報:
  タイプ: Amazon Linux 2023
  Elastic IP: 35.76.100.207（新規割り当て）
  旧IP: 18.181.244.62（無効）
  リージョン: ap-northeast-1（東京）
  
稼働サービス:
  - Node.js 18.20.8: ✅インストール済み
  - PM2: ✅インストール済み
  - Nginx: ✅インストール済み
  - アプリケーション: ポート8080で稼働中（推定）

接続状況:
  SSH（ポート22）: ❌ タイムアウト
  HTTP（ポート80）: ❌ 未確認
  HTTPS（ポート443）: ❌ 未設定
```

### RDS MySQL
```yaml
エンドポイント: hokka-db.cdk0iio0s90g.ap-northeast-1.rds.amazonaws.com
ポート: 3306
ユーザー: admin
パスワード: hokka-beaver-quiz-20250810
データベース: hokka_quiz（作成予定）

接続状況:
  ローカル環境から: ❌ タイムアウト
  EC2から: ❌ 未確認（SSH接続不可のため）
```

## 2. 現在の問題点

### 🔴 緊急度：高
1. **EC2へのSSH接続不可**
   - 症状: `ssh: connect to host 35.76.100.207 port 22: Connection timed out`
   - 影響: サーバー管理、デプロイ、設定変更が一切不可

2. **RDSへの接続不可**
   - 症状: ポート3306への接続タイムアウト
   - 影響: データベース初期設定、テーブル作成不可

### 🟡 緊急度：中
3. **外部からのHTTPアクセス不可**
   - ポート80、443が開放されていない可能性
   - 影響: アプリケーションへの外部アクセス不可

## 3. 推測される原因と必要な対処

### セキュリティグループ設定（最重要）

#### EC2用セキュリティグループ
現在の推定状態と必要な設定：

| タイプ | プロトコル | ポート | ソース | 現状 | 必要性 |
|--------|-----------|--------|--------|------|--------|
| SSH | TCP | 22 | 管理者IP | ❌閉鎖 | 🔴必須 |
| HTTP | TCP | 80 | 0.0.0.0/0 | ❌閉鎖 | 🔴必須 |
| HTTPS | TCP | 443 | 0.0.0.0/0 | ❌閉鎖 | 🟡将来 |
| カスタムTCP | TCP | 8080 | 0.0.0.0/0 | ❓不明 | 🟢任意 |

#### RDS用セキュリティグループ
| タイプ | プロトコル | ポート | ソース | 現状 | 必要性 |
|--------|-----------|--------|--------|------|--------|
| MySQL/Aurora | TCP | 3306 | EC2のSG-ID | ❌未設定 | 🔴必須 |
| MySQL/Aurora | TCP | 3306 | 開発環境IP | ❌未設定 | 🟡開発用 |

## 4. 質問事項

### Q1: セキュリティグループの現在の設定
- EC2インスタンスに適用されているセキュリティグループのインバウンドルールを教えてください
- RDSに適用されているセキュリティグループのインバウンドルールを教えてください

### Q2: Elastic IPの関連付け状態
- Elastic IP（35.76.100.207）は正しくEC2インスタンスに関連付けられていますか？
- EC2インスタンスは起動中ですか？

### Q3: VPC設定
- EC2とRDSは同じVPC内にありますか？
- RDSのパブリックアクセシビリティは有効ですか？

### Q4: ネットワークACL
- VPCのネットワークACLで特別な制限をかけていますか？

## 5. 推奨される対処手順

### Step 1: EC2セキュリティグループ修正（最優先）
```
1. AWSコンソール → EC2 → セキュリティグループ
2. EC2インスタンスのセキュリティグループを選択
3. インバウンドルールを編集：
   - SSH (22): 管理者のIPアドレスから許可
   - HTTP (80): 0.0.0.0/0から許可
   - HTTPS (443): 0.0.0.0/0から許可（将来用）
```

### Step 2: RDSセキュリティグループ修正
```
1. RDSインスタンスのセキュリティグループを選択
2. インバウンドルールを編集：
   - MySQL/Aurora (3306): EC2のセキュリティグループIDから許可
   - MySQL/Aurora (3306): 開発環境IPから一時的に許可
```

### Step 3: 接続確認
```bash
# SSH接続テスト
ssh -i hokka-beaver-quiz-key.pem ec2-user@35.76.100.207

# RDS接続テスト（EC2から）
mysql -h hokka-db.cdk0iio0s90g.ap-northeast-1.rds.amazonaws.com -u admin -p

# アプリケーション確認
curl http://35.76.100.207/
```

## 6. アプリケーション情報（参考）

### 機能要件
- 200名同時接続対応のクイズラリーシステム
- 10問のクイズ問題配信
- リアルタイムランキング表示
- 管理者機能（問題管理、CSV出力）

### 技術スタック
- Node.js 18 + 自作HTTPサーバー
- 現在: インメモリDB + JSON永続化
- 移行先: RDS MySQL

### 必要なポート
- 22: SSH管理用
- 80: HTTP公開アクセス
- 443: HTTPS公開アクセス（将来）
- 3306: RDSデータベース接続
- 8080: Node.jsアプリケーション（内部）

## 7. 緊急度別アクションアイテム

### 🔴 今すぐ必要（アプリケーション動作に必須）
1. EC2セキュリティグループでSSH(22)を開放
2. EC2セキュリティグループでHTTP(80)を開放
3. RDSセキュリティグループでMySQL(3306)を開放

### 🟡 近日中に必要（本番運用前）
1. HTTPS証明書の設定（Let's Encrypt）
2. ドメイン名の設定（Route53）
3. CloudWatchによる監視設定

### 🟢 将来的に検討
1. ロードバランサーの導入
2. Auto Scalingの設定
3. CloudFrontによるCDN配信

## 質問

**上記の状況を踏まえて、セキュリティグループの具体的な設定方法と、その他見落としている可能性のある設定について教えてください。特に、中学校文化祭という一般公開イベントでの使用を考慮した適切なセキュリティ設定をアドバイスください。**